const visLayer=document.getElementById("cnvLayer1"),uiLayer=document.getElementById("cnvLayer2"),textLayer=document.getElementById("cnvLayer3"),file=document.getElementById("file-input"),audio=document.getElementById("audio"),ctx1=visLayer.getContext("2d"),ctx2=uiLayer.getContext("2d"),ctx3=textLayer.getContext("2d");var WIDTH,HEIGHT,barWidth,x=[],y=[];function resizeApp(){var t,e=document.getElementById("audio").scrollHeight;visLayer.width=window.innerWidth,visLayer.height=window.innerHeight-e,uiLayer.width=window.innerWidth,uiLayer.height=window.innerHeight-e,textLayer.width=window.innerWidth,textLayer.height=window.innerHeight-e,WIDTH=visLayer.width,HEIGHT=visLayer.height,t=window.innerHeight-e,audio.style.marginTop=t.toString()+"px",t=window.innerHeight-e+9,file.style.marginTop=t.toString()+"px",document.documentElement.style.overflow="hidden",document.body.scroll="no",x=new Float32Array(computeLogX()),y=new Uint8Array(FFTANALYSER.getData()),drawMarginals()}function main(){!function t(){requestAnimationFrame(t),clear(ctx1),lineGraph(),ctx1.fillStyle="rgba(0, 0, 0, 0.5)",ctx1.fillRect(0,HEIGHT-24,WIDTH,24,24)}()}function binGraph(){var t,e;y=FFTANALYSER.getData();for(var n=0;n<x.length;n++)t=HEIGHT*(y[n]/255),(barWidth=WIDTH/x.length)<1&&(barWidth=1),e=y[n],ctx1.fillStyle=`hsl(${e},100%,50%)`,ctx1.fillRect(x[n],HEIGHT-t,barWidth,t)}function lineGraph(){y=FFTANALYSER.getData();var t=0;ctx1.beginPath();for(var e=1;e<x.length;e++){HEIGHT*(y[e]/255);var n=HEIGHT*(y[e]/255),i=HEIGHT*(y[e-1]/255);ctx1.moveTo(x[e],HEIGHT-n),ctx1.lineTo(t,HEIGHT-i),t=x[e],y[e]}var r=ctx1.createLinearGradient(0,HEIGHT,0,0);r.addColorStop("0.166","rgba(35,210,255,1)"),r.addColorStop("0.333","rgba(74,104,247,1)"),r.addColorStop("0.50","rgba(133,80,255,1)"),r.addColorStop("0.666","rgba(198,59,243,1)"),r.addColorStop("0.833","rgba(250,84,118,1)"),r.addColorStop("1.0","rgba(255,223,67,1)"),ctx1.closePath(),ctx1.strokeStyle=r,ctx1.stroke(),ctx1.fillStyle=r,ctx1.fill()}function drawMarginals(){for(var t=0,e=0;e<x.length;e++)if(e>=2*t){var n=Math.round(44100*e/8192);t=e,ctx2.font="12px Sans-Serif",ctx2.fillStyle="white",ctx2.textAlign="center",ctx2.fillText(n+"Hz",x[e],HEIGHT-6)}}function computeLogX(){for(var t=[],e=FFTANALYSER.getSize(),n=0;n<e;n++){var i=Math.log10(1470),r=Math.log10(n/15*22050/e);t.push(r/i*WIDTH)}return t}function setPixel(t,e,n,i){t.fillStyle=`hsl(${i}, 100%, 50%)`,t.fillRect(e,n,1,1)}function lerp(t,e,n){return t+(e-t)*n}function clear(t){t.fillStyle="rgba(25,25,25,1.0)",t.fillRect(0,0,WIDTH,HEIGHT)}function gradFill(t){var e=t.createLinearGradient(0,0,WIDTH,0);e.addColorStop("0","hsl(0,100%,50%)"),e.addColorStop("1","hsl(255,100%,50%)"),t.fillStyle=e,t.fillRect(0,0,WIDTH,HEIGHT)}function getMousePos(t,e){var n=t.getBoundingClientRect();return{x:e.clientX-n.left,y:e.clientY-n.top}}window.addEventListener("resize",resizeApp),file.onchange=function(){const t=this.files;console.log("FILES[0]: ",t[0]),audio.src=URL.createObjectURL(t[0]),FFTANALYSER.init(),resizeApp(),audio.play(),main()},FFTANALYSER=function(){const t=document.getElementById("audio"),e=new AudioContext({sampleRate:44100});let n=e.createMediaElementSource(t);const i=e.createAnalyser();var r;function o(t){t&&0==(t&t-1)?(i.fftSize=t,i.maxDecibels=-18,r=i.frequencyBinCount):alert("FFT size is required to be a power of two.")}return window.onload=function(){},{init:function(){n.connect(i),i.connect(e.destination),o(8192)},setSize:o,getSize:function(){return r},getData:function(){var t=new Uint8Array(r);return i.getByteFrequencyData(t),t}}}();
